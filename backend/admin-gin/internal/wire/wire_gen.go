// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package wire

import (
	"mall-api/configs"
	"mall-api/internal/app/wire"
	"mall-api/internal/router"
	"mall-api/pkg/database"

	"github.com/gin-gonic/gin"
	"github.com/redis/go-redis/v9"
	"gorm.io/gorm"
)

// Injectors from wire.go:

// InitApp builds the full application graph: DB, Redis, Gin Engine, module handlers,
// and routes registration.
//
// Best practice: config is loaded in cmd/* (via viper) and passed in explicitly,
// so the injector has no filesystem/env side-effects.
func InitApp(cfg *configs.Config) (*App, error) {
	engine := provideGinEngine()
	postgreConfig, err := database.ProvidePostgreConfig(cfg)
	if err != nil {
		return nil, err
	}
	db, err := database.NewPostgre(postgreConfig)
	if err != nil {
		return nil, err
	}
	redisConfig, err := database.ProvideRedisConfig(cfg)
	if err != nil {
		return nil, err
	}
	client, err := database.NewRedis(redisConfig)
	if err != nil {
		return nil, err
	}
	adminHandlers, err := provideAdminHandlers(db, client)
	if err != nil {
		return nil, err
	}
	wireRoutersRegistered := provideRouters(engine, db, client)
	app := &App{
		Engine:            engine,
		DB:                db,
		RDB:               client,
		AdminHandlers:     adminHandlers,
		RoutersRegistered: wireRoutersRegistered,
	}
	return app, nil
}

// wire.go:

// App is the fully-wired application object returned by the injector.
type App struct {
	Engine *gin.Engine
	DB     *gorm.DB
	RDB    *redis.Client

	// Keep these as fields so Wire considers the providers "used" and also so
	// the application graph guarantees these side-effects happen during init.
	AdminHandlers     *wire.AdminHandlers
	RoutersRegistered routersRegistered
}

// routersRegistered is a no-op marker type used to model "route registration happened"
// as a Wire-provided dependency.
type routersRegistered struct{}

// provideGinEngine constructs a bare gin engine. Middlewares are configured in main
// in this repo; if you want to move middleware wiring into Wire, do it here.
func provideGinEngine() *gin.Engine {
	return gin.New()
}

// provideAdminHandlers wires up admin module handlers (auth/user/etc).
func provideAdminHandlers(db *gorm.DB, rdb *redis.Client) (*wire.AdminHandlers, error) {
	return wire.InitAdminHandlers(db, rdb)
}

// provideRouters registers routes onto gin.Engine (side-effect) and returns a marker.
// Wire providers must return at least one output, so we return a no-op type here.
func provideRouters(r *gin.Engine, db *gorm.DB, rdb *redis.Client) routersRegistered {
	router.Router(r, db, rdb)
	return routersRegistered{}
}
